<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

  <title>Test Page</title>
  <style>
    body{
      background-color: #eee;
    }
    @media (min-width: 768px) {
  .modal-content {
    max-width: 350px;
  }
}

    /* Modal overlay and content */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      box-sizing: border-box;
      text-align: center;
    }
    .modal-content img {
      max-width: 90%;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .modal-content button {
      margin-top: 5px;
      padding: 8px 20px;
      border: none;
      background-color: #0077cc;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    /* Book cards container */
    #bookGallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    /* Individual book card */
    .card {
      background: white;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.15s ease;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .card h3 {
      margin: 0 0 5px 0;
      font-size: 1rem;
    }
    .card p {
      margin: 0 0 8px 0;
      font-size: 0.85rem;
      color: #555;
      font-style: italic;
    }
    /* Card action buttons */
    .actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .actions button {
      flex: 1;
      padding: 6px 0;
      border: none;
      border-radius: 4px;
      font-size: 0.85rem;
      cursor: pointer;
      color: white;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .actions button.edit-btn {
      background-color: #f0ad4e;
    }
    .actions button.edit-btn:hover {
      background-color: #ec971f;
    }
    .actions button.delete-btn {
      background-color: #d9534f;
    }
    .actions button.delete-btn:hover {
      background-color: #c9302c;
    }
    /* Form inside modal for editing */
    form label {
      display: block;
      margin: 8px 0 4px 0;
      text-align: left;
      font-weight: bold;
      font-size: 0.9rem;
    }
    form input, form select, form textarea {
      width: 100%;
      padding: 6px 8px;
      font-size: 0.9rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    form textarea {
      resize: vertical;
    }
    form .form-actions {
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    form .form-actions button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      color: white;
    }
    form .form-actions button.save-btn {
      background-color: #0077cc;
    }
    form .form-actions button.save-btn:hover {
      background-color: #005fa3;
    }
    form .form-actions button.cancel-btn {
      background-color: #aaa;
    }
    form .form-actions button.cancel-btn:hover {
      background-color: #888;
    }
  </style>
</head>
<body>
  <h1>Hello World</h1>
  <div style="display:flex; gap: 20px;">
    <aside style="width:200px; background:#eee; padding:10px;">
      <input placeholder="Search..." id="searchInput" /><br /><br />
      <select id="categoryFilter">
        <option value="">All Categories</option>
        <option value="Classic">Classic</option>
        <option value="Fiction">Fiction</option>
        <option value="Fantasy">Fantasy</option>
      </select><br /><br />
      <button id="addBookBtn">Add Book</button>
    </aside>
    <main style="background:#eee;
     padding:10px; flex:1;">
      <div id="bookGallery"></div>
    </main>
  </div>

  <!-- Details Modal -->
  <div class="modal-overlay" id="detailsModal">
    <div class="modal-content">
      <img id="detailsCover" src="" alt="Book Cover" />
      <h2 id="detailsTitle"></h2>
      <h4 id="detailsAuthor"></h4>
      <p id="detailsDescription"></p>
      <button id="closeDetailsBtn">Close</button>
    </div>
  </div>

  <!-- Edit/Add Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal-content">
      <form id="bookForm">
        <input type="hidden" id="bookId" />
        <label for="titleInput">Title:</label>
        <input type="text" id="titleInput" required />
        <label for="authorInput">Author:</label>
        <input type="text" id="authorInput" required />
    <label for="categoryInput">Category:</label>
<select id="categoryInput" required>
  <option value="">Select Category</option>
  <option value="Classic">Classic</option>
  <option value="Fiction">Fiction</option>
  <option value="Fantasy">Fantasy</option>
  <option value="__add_new__">Add new category...</option>
</select>
<!-- <label for="coverInput">Cover Image URL:</label>
<input type="url" id="coverInput" /> -->

<label for="fileInput">Upload PDF:</label>
<input type="file" id="fileInput" accept="application/pdf" required />

<!-- <label for="coverFileInput">Or Upload Cover Image:</label> -->
<!-- <input type="file" id="coverFileInput" accept="PDF/*" /> -->

        <label for="descriptionInput">Description:</label>
        <textarea id="descriptionInput" rows="4" required></textarea>
        <div class="form-actions">


          <button type="submit" class="save-btn">Save</button>
          <button type="button" class="cancel-btn" id="cancelEditBtn">Cancel</button>
        </div>
      </form>
    </div>
  </div>

<script>
  const books = [
    {
      id: 1,
      title: 'The Great Gatsby',
      author: 'F. Scott Fitzgerald',
      cover: 'https://covers.openlibrary.org/b/id/7352161-L.jpg',
      category: 'Classic',
      description: 'A novel about the American dream and high society in the 1920s.'
    },
    {
      id: 2,
      title: 'To Kill a Mockingbird',
      author: 'Harper Lee',
      cover: 'https://covers.openlibrary.org/b/id/8228691-L.jpg',
      category: 'Classic',
      description: 'A story of racial injustice in the Deep South seen through a childâ€™s eyes.'
    },
    {
      id: 3,
      title: '1984',
      author: 'George Orwell',
      cover: 'https://covers.openlibrary.org/b/id/7222246-L.jpg',
      category: 'Fiction',
      description: 'A dystopian novel about totalitarian regime and surveillance.'
    },
    {
      id: 4,
      title: 'Harry Potter and the Sorcerer\'s Stone',
      author: 'J.K. Rowling',
      cover: 'https://covers.openlibrary.org/b/id/7984916-L.jpg',
      category: 'Fantasy',
      description: 'The first book in the beloved wizarding series.'
    },
    {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },
        {
      id: 4,
      title: 'Harry Potter and the Sorcerer\'s Stone',
      author: 'J.K. Rowling',
      cover: 'https://covers.openlibrary.org/b/id/7984916-L.jpg',
      category: 'Fantasy',
      description: 'The first book in the beloved wizarding series.'
    },
    {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },    {
      id: 4,
      title: 'Harry Potter and the Sorcerer\'s Stone',
      author: 'J.K. Rowling',
      cover: 'https://covers.openlibrary.org/b/id/7984916-L.jpg',
      category: 'Fantasy',
      description: 'The first book in the beloved wizarding series.'
    },
    {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },
      {
      id: 4,
      title: 'Harry Potter and the Sorcerer\'s Stone',
      author: 'J.K. Rowling',
      cover: 'https://covers.openlibrary.org/b/id/7984916-L.jpg',
      category: 'Fantasy',
      description: 'The first book in the beloved wizarding series.'
    },
    {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },  
     {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },
      {
      id: 4,
      title: 'Harry Potter and the Sorcerer\'s Stone',
      author: 'J.K. Rowling',
      cover: 'https://covers.openlibrary.org/b/id/7984916-L.jpg',
      category: 'Fantasy',
      description: 'The first book in the beloved wizarding series.'
    },
    {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },   {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },
      {
      id: 4,
      title: 'Harry Potter and the Sorcerer\'s Stone',
      author: 'J.K. Rowling',
      cover: 'https://covers.openlibrary.org/b/id/7984916-L.jpg',
      category: 'Fantasy',
      description: 'The first book in the beloved wizarding series.'
    },
    {
      id: 5,
      title: 'The Hobbit',
      author: 'J.R.R. Tolkien',
      cover: 'https://covers.openlibrary.org/b/id/6979861-L.jpg',
      category: 'Fantasy',
      description: 'A fantasy adventure preceding the Lord of the Rings trilogy.'
    },  
  ];

  const masterPassword = 'admin123';

  const bookGallery = document.getElementById('bookGallery');
  const detailsModal = document.getElementById('detailsModal');
  const editModal = document.getElementById('editModal');
const pdfFileInput = document.getElementById('pdfFileInput');


  const detailsCover = document.getElementById('detailsCover');
  const detailsTitle = document.getElementById('detailsTitle');
  const detailsAuthor = document.getElementById('detailsAuthor');
  const detailsDescription = document.getElementById('detailsDescription');
  const closeDetailsBtn = document.getElementById('closeDetailsBtn');

  const bookForm = document.getElementById('bookForm');
  const bookIdInput = document.getElementById('bookId');
  const titleInput = document.getElementById('titleInput');
  const authorInput = document.getElementById('authorInput');
  const categoryInput = document.getElementById('categoryInput');
  // const coverInput = document.getElementById('coverInput');
  const descriptionInput = document.getElementById('descriptionInput');
  const cancelEditBtn = document.getElementById('cancelEditBtn');

  const searchInput = document.getElementById('searchInput');
  const categoryFilter = document.getElementById('categoryFilter');
  const addBookBtn = document.getElementById('addBookBtn');

  let currentBooks = [...books]; // copy to work with filters

  function renderBooks() {
    bookGallery.innerHTML = '';
    currentBooks.forEach(book => {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.id = book.id;

      card.innerHTML = `
      <img src="${book.cover}" alt="${book.title}" />
        <h3>${book.title}</h3>
        <p>${book.author}</p>
        <div class="actions">
          <button class="edit-btn">Edit</button>
          <button class="delete-btn">Delete</button>
        </div>
      `;

      // Clicking on card image or title shows details modal
      card.querySelector('img').addEventListener('click', () => showDetails(book.id));
      card.querySelector('h3').addEventListener('click', () => showDetails(book.id));

      // Edit button
      card.querySelector('.edit-btn').addEventListener('click', e => {
        e.stopPropagation();
        openEditModal(book.id);
      });

      // Delete button
      card.querySelector('.delete-btn').addEventListener('click', e => {
        e.stopPropagation();
        handleDelete(book.id);
      });

      bookGallery.appendChild(card);
    });
  }

  categoryInput.addEventListener('change', () => {
  if (categoryInput.value === '__add_new__') {
    const newCategory = prompt('Enter new category name:');
    if (newCategory && newCategory.trim()) {
      addCategoryToFilter(trimmed);
      const trimmed = newCategory.trim();

      // Create and insert new option before the last one ("Add new")
      const newOption = new Option(trimmed, trimmed);
      categoryInput.insertBefore(newOption, categoryInput.lastElementChild);
      categoryInput.value = trimmed;
    } else {
      categoryInput.value = '';
    }
  }
});
function addCategoryToFilter(categoryName) {
  const exists = Array.from(categoryFilter.options).some(opt => opt.value === categoryName);
  if (!exists) {
    const option = new Option(categoryName, categoryName);
    categoryFilter.appendChild(option);
  }
}

  function showDetails(id) {
    const book = books.find(b => b.id === id);
    if (!book) return;
    detailsCover.src = book.cover;
    detailsTitle.textContent = book.title;
    detailsAuthor.textContent = 'by ' + book.author;
    detailsDescription.textContent = book.description;
    detailsModal.style.display = 'flex';
  }

  closeDetailsBtn.addEventListener('click', () => {
    detailsModal.style.display = 'none';
  });

  function openEditModal(id = null) {
    if (id) {
      const book = books.find(b => b.id === id);
      if (!book) return;
      bookIdInput.value = book.id;
      titleInput.value = book.title;
      authorInput.value = book.author;
      categoryInput.value = book.category;
      // coverInput.value = book.cover;
      descriptionInput.value = book.description;
    } else {
      // For adding new book
      bookIdInput.value = '';
      titleInput.value = '';
      authorInput.value = '';
      categoryInput.value = '';
      // coverInput.value = '';
      descriptionInput.value = '';
    }
    editModal.style.display = 'flex';
  }

  cancelEditBtn.addEventListener('click', () => {
    editModal.style.display = 'none';
  });

const coverFileInput = document.getElementById('coverFileInput'); // Add this line at top with other getElementById
async function getFirstPageImage(file) {
  const fileReader = new FileReader();

  return new Promise((resolve, reject) => {
    fileReader.onload = async function () {
      const typedarray = new Uint8Array(this.result);
      const loadingTask = pdfjsLib.getDocument({ data: typedarray });
      const pdf = await loadingTask.promise;
      const page = await pdf.getPage(1);

      const viewport = page.getViewport({ scale: 1.5 });
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.height = viewport.height;
      canvas.width = viewport.width;

      await page.render({ canvasContext: context, viewport }).promise;
      const imageDataUrl = canvas.toDataURL();
      resolve(imageDataUrl);
    };

    fileReader.onerror = reject;
    fileReader.readAsArrayBuffer(file);
  });
}


bookForm.addEventListener('submit', async e => {
  e.preventDefault();
  const id = bookIdInput.value;
  const file = document.getElementById('fileInput').files[0];

  if (!file || file.type !== 'application/pdf') {
    alert('Please upload a valid PDF file.');
    return;
  }

  const coverImage = await getFirstPageImage(file);

  const newBook = {
    id: id ? parseInt(id) : Date.now(),
    title: titleInput.value,
    author: authorInput.value,
    category: categoryInput.value,
    description: descriptionInput.value,
    cover: coverImage,
  };

  if (id) {
    // Update existing book
    const index = books.findIndex(b => b.id === parseInt(id));
    if (index !== -1) {
      books[index] = newBook;
    }
  } else {
    books.push(newBook);
  }

  currentBooks = [...books];
  renderBooks();
  editModal.style.display = 'none';
});



function saveBook(pdfDataUrl) {
  const id = bookIdInput.value;
  const bookData = {
    title: titleInput.value,
    author: authorInput.value,
    category: categoryInput.value,
    // cover: coverInput.value || '', // optional image URL
    description: descriptionInput.value,
    pdf: pdfDataUrl
  };

  if (id) {
    const book = books.find(b => b.id == id);
    if (book) {
      Object.assign(book, bookData);
    }
  } else {
    books.push({
      id: Date.now(),
      ...bookData
    });
  }

  pdfFileInput.value = '';
  // coverInput.value = '';
  applyFilters();
  editModal.style.display = 'none';
}


function saveBook(coverValue) {
  const id = bookIdInput.value;
  if (id) {
    // Editing an existing book
    const book = books.find(b => b.id == id);
    if (book) {
      book.title = titleInput.value;
      book.author = authorInput.value;
      book.category = categoryInput.value;
      book.cover = coverValue;
      book.description = descriptionInput.value;
    }
  } else {
    // Adding a new book
    const newBook = {
      id: Date.now(),
      title: titleInput.value,
      author: authorInput.value,
      category: categoryInput.value,
      cover: coverValue,
      description: descriptionInput.value,
    };
    books.push(newBook);
  }

  // Reset form
  coverFileInput.value = '';
  // coverInput.value = '';

  applyFilters();
  editModal.style.display = 'none';
}


  function handleDelete(id) {
    const pass = prompt('Enter master password to delete this book:');
    if (pass === masterPassword) {
      if (confirm('Are you sure you want to delete this book?')) {
        const index = books.findIndex(b => b.id === id);
        if (index > -1) {
          books.splice(index, 1);
          applyFilters();
          alert('Book deleted.');
        }
      }
    } else {
      alert('Incorrect password. Deletion cancelled.');
    }
  }

  function applyFilters() {
    const searchTerm = searchInput.value.trim().toLowerCase();
    const category = categoryFilter.value;

    currentBooks = books.filter(book => {
      const matchesSearch = 
        book.title.toLowerCase().includes(searchTerm) ||
        book.author.toLowerCase().includes(searchTerm);
      const matchesCategory = category === '' || book.category === category;
      return matchesSearch && matchesCategory;
    });

    renderBooks();
  }

  searchInput.addEventListener('input', applyFilters);
  categoryFilter.addEventListener('change', applyFilters);

  addBookBtn.addEventListener('click', () => openEditModal(null));

  // Initial render
  renderBooks();
</script>
</body>
</html>
